
<html>
<head>
  <title>Snapshots & Distributions</title>
  <meta name="Description" content="QuArK Information Database - Page: 4.12.&nbsp;Snapshots & Distributions">
  <meta name="Keywords" content="QuArK InfoBase Quake Army Knife QRK QKM Python PY Map Editor Hexen Heretic Half-Life Sin Kingpin Soldier-of-Fortune Star-Trek-Voyager Elite-Force">
</head>

<link rel=stylesheet href="standard.css" type="text/css">

<body>
<a name="__top__"></a>
<table width=100% border=0 cellspacing=0>
  <tr>
    <td width=213>
      <a href="http://www.planetquake.com/quark"><img src="quarkicon.png" width=213 height=90 border=0 alt="Go to QuArK Web Site"></a>
    </td>
    <td width=70% align=center>
      <div class="topheadline">Snapshots & Distributions</div>
      <div class="sm">Updated&nbsp;15 Jan 2004</div>
    </td>
    <td width=30% valign=bottom nowrap>
      Upper&nbsp;levels:<br>-&nbsp;<a href="index.html">QuArK&nbsp;Information&nbsp;Base</a><br>-&nbsp;<a href="src.html">4.&nbsp;The&nbsp;Source&nbsp;Code</a><br>
    </td>
  </tr>
</table>
<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99%>
      <p class="headline">&nbsp;4.12.&nbsp;Snapshots & Distributions</p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.delphi.html">Prev</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.html">Up</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="plans.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
<table border=0 width=100% cellspacing=10><tr><td><p>This section describes QuArK distribution policy, tools and
methodology.</p>
</td></tr></table>
<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=100%>
      <p class="subheadline">&nbsp;Index</p>
    </td>
  </tr>
</table>
<ul class="index">
  <li>- <a href="#policy">QuArK Release Policy</a>&nbsp;<span class="added">(15 Jan 2004)</span>
  <li>- <a href="#snapshot">Releasing a Snapshot</a>&nbsp;<span class="added">(15 Jan 2004)</span>
  <li>- <a href="#dist">Releasing a Distribution</a>&nbsp;<span class="added">(15 Jan 2004)</span>
</ul>
<br>


<a name="policy"></a>
  <table width=100% border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;QuArK Release Policy</p>
      </td>
      <td align=right>
        <font size=-2>Peter Brett&nbsp;-&nbsp;15 Jan 2004</font>
      </td>
      <td width=1% align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width=100% cellspacing=10><tr><td>
<p>QuArK has two types of releases: distributions and snapshots.
</p><p><ol>
<li>Distributions are released through the SourceForge Release System.
A distribution consists of the following files:
<ul>
<li>&nbsp;<tt>quark-win32-version.exe</tt>&nbsp; - a Nullsoft Scriptable Install
System executable containing the QuArK Windows binaries with a bundled
Python micro-distribution and the Infobase.</li>
<li>&nbsp;<tt>quark-win32-version.zip</tt>&nbsp; - a zip archive containing the
QuArK Windows binaries with a bundled Python micro-distribution and
the Infobase.</li>
<li>&nbsp;<tt>quark-src-version.zip</tt>&nbsp; - a zip archive containing full
exports of the &nbsp;<tt>infobase</tt>&nbsp;, &nbsp;<tt>runtime</tt>&nbsp; and &nbsp;<tt>source</tt>&nbsp; CVS modules.</li>
<li>&nbsp;<tt>quark-help-version.zip</tt>&nbsp; - a zip archive containing the
compiled Infobase.</li>
</ul>
You will need to have &quot;Release Technician&quot; permissions on the QuArK
SourceForge project to be able to release a distribution.
</p><p>N.B. that version numbers are in the format
&nbsp;<tt>#.#.#state#</tt>&nbsp; where 'state' can be one of 'rel', 'beta', or
'alpha'.  The numbers before the current state are the major and minor
versions, and the number after the state is the release number at that
version/state. Examples:<ul><li>&nbsp;<tt>6.4.0alpha1</tt>&nbsp;. Note also that version numbers should be <strong>unique</strong>.</li>
<li>&nbsp;<tt>6.3.0rel4</tt>&nbsp;</li></ul>
</li>
<li>Snapshots are released on QuArK's SourceForge webspace (
<a href="http://quark.sourceforge.net">http://quark.sourceforge.net</a>).
A snapshot consists of the following files:
<ul>
<li>&nbsp;<tt>quark-win32-date.zip</tt>&nbsp; - a zip archive containing the QuArK
Windows binaries with a bundled Python micro-distribution and the 
Infobase.</li>
<li>&nbsp;<tt>quark-src-date.zip</tt>&nbsp; - a zip archive containing full
exports of the &nbsp;<tt>infobase</tt>&nbsp;, &nbsp;<tt>runtime</tt>&nbsp; and &nbsp;<tt>source</tt>&nbsp;
CVS modules.</li>
<li>&nbsp;<tt>quark-help-date.zip</tt>&nbsp; - a zip archive containing the
compiled Infobase.</li>
</ul>
You will need to have access to the QuArK project's SourceForge
webspace (i.e. a SourceForge shell account is required) to be able to
release a snapshot.
</p><p>N.B. that dates should be in the format &nbsp;<tt>YYYYMMDD</tt>&nbsp;.
</li>
</ol>
</p><p>Typically, QuArK snapshots are released every couple of weeks,
although this may vary depending on how much work is being done.  If
two weeks go by with very little CVS activity, there won't be much
point in making a snapshot; equally, if things are frenetic, it's
likely we'll do snapshots more frequently.  Also, it depends how much
time the release technicians have available.
</p><p>Distributions are done on a much less frequent basis, because they
require much more work on the part of whoever's doing the releases.</p>
  </td></tr></table>
  <br>

<a name="snapshot"></a>
  <table width=100% border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Releasing a Snapshot</p>
      </td>
      <td align=right>
        <font size=-2>Peter Brett&nbsp;-&nbsp;15 Jan 2004</font>
      </td>
      <td width=1% align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width=100% cellspacing=10><tr><td>
<p>Here's the process you might follow to prepare and release a snapshot.
Before you'll be able to follow the process outlined below, you'll
need to read <a href="http://sourceforge.net/docman/display_doc.php?docid=6841&group_id=1">Introduction
to SSH on SourceForge.net</a>, and set up your system with PuTTY
accordingly.
</p><p>I'm going to assume that the date is 31st August 2007.
</p><p><ol>
<li>Build a QuArK binary with &nbsp;<tt>PYTHON_BUNDLED</tt>&nbsp; and compress it
using UPX (available from 
<a href="http://upx.sourceforge.net/">http://upx.sourceforge.net/</a>).
You should use:
<div class="doccode"><pre>&gt; upx -9 --compress-icons=0 QuArK.exe</pre></div>
</li>
<li>Use PSFTP to upload it to your user account on the shell server.
Also upload the latest micro-Python files.
<div class="doccode"><pre>&gt; psftp shell.sourceforge.net
psftp&gt; put QuArK.exe
psftp&gt; put micro-python22.zip
psftp&gt; quit</pre></div></li>
<li>PuTTY to the shell server and change to the QuArK directory.
<div class="doccode"><pre>&gt; putty shell.sourceforge.net
$ cd /home/groups/q/qu/quark</pre></div></li>
<li>Do a CVS export of the &nbsp;<tt>infobase</tt>&nbsp;, &nbsp;<tt>runtime</tt>&nbsp; and &nbsp;<tt>source</tt>&nbsp; modules.
<div class="doccode"><pre>$ cvs -z3 -Q -d:pserver:anonymous@cvs1:/cvsroot/quark export -rHEAD infobase
$ cvs -z3 -Q -d:pserver:anonymous@cvs1:/cvsroot/quark export -rHEAD runtime
$ cvs -z3 -Q -d:pserver:anonymous@cvs1:/cvsroot/quark export -rHEAD source
</pre></div>
We use the CVS export command because that way we get a clean copy of
the files without the CVS folders.</li>
<li>Extract the micro-Python files.
<div class="doccode"><pre>$ unzip -q ~/micro-python22.zip</pre></div></li>
<li>Create folders for each of the three files you're
going to need in the end.
<div class="doccode"><pre>$ mkdir quark-help-20070831
$ mkdir quark-src-20070831
$ mkdir quark-win32-20070831</pre></div></li>
<li>Build the Infobase, and copy the output to where it's needed.
<div class="doccode"><pre>$ mkdir quark-win32-20070831/help
$ cd infobase
$ python ./build.py -local
$ cp -r output/* ../quark-help-20070831/
$ cp -r output/* ../quark-win32-20070831/help
$ rm -rf output
$ cd ..</pre></div></li>
<li>Put together the files for the source snapshot.
<div class="doccode"><pre>$ cp -r infobase/ quark-src-20070831/
$ cp -r source/ quark-src-20070831/
$ cp -r runtime/ quark-src-20070831/
$ cp -r micro-python22/ quark-src-20070831/</pre></div></li>
<li>Put together the files for the Windows binary snapshot.
<div class="doccode"><pre>$ cp ~/QuArK.exe quark-win32-20070831
$ cp -r runtime/* quark-win32-20070831/
$ rm -f quark-win32-20070831/dlls/d3dxas.dll
$ rm -f quark-win32-20070831/dlls/readme.txt
$ cp micro-python22/dlls/python.dll quark-win32-20070821/dlls/
</pre></div></li>
<li>Zip up the files.
<div class="doccode"><pre>$ zip -9rq quark-help-20070831.zip quark-help-20070831/
$ zip -9rq quark-src-20070831.zip quark-src-20070831/
$ zip -9rq quark-win32-20070831.zip quark-win32-20070831/</pre></div></li>
<li>Remove working directories.
<div class="doccode"><pre>$ rm -rf source/ infobase/ runtime/ quark-src-20070831/
$ rm -rf quark-help-20070831/ quark-win32-20070831/</pre></div></li>
<li>Move our snapshot files into the website's download directory and
generate MD5 checksums.
<div class="doccode"><pre>$ mv quark*.zip htdocs/download/
$ cd htdocs/download/
$ md5sum quark-help-20070831.zip &gt; quark-help-20070831.zip.md5
$ md5sum quark-src-20070831.zip &gt; quark-src-20070831.zip.md5
$ md5sum quark-win32-20070831.zip &gt; quark-win32-20070831.zip.md5
</pre></div></li>
<li>You now need to edit the &nbsp;<tt>/home/q/qu/quark/htdocs/index.html</tt>&nbsp; file
to add the new snapshot.  Use the text editor of your choice - I
generally use Emacs.
</p><p>You should also e-mail a release announcement to the development
mailing list (<a href="mailto:quark-python@yahoogroups.com">quark-python@yahoogroups.com</a>),
something along the lines of:
</p><div class="doccode"><pre>Subject: Snapshots 20070831

New QuArK snapshots are now available from
http://quark.sourceforge.net/

- Compiled Infobase:
http://quark.sourceforge.net/download/quark-help-20070831.zip
- Full source code with Python 2.2.3:
http://quark.sourceforge.net/download/quark-src-20070831.zip
- Win32 binaries with Python 2.2.3:
http://quark.sourceforge.net/download/quark-win32-20070831.zip
</pre></div>

<p>It's also a good idea only to have four snapshots on the site at a
time, so as to be sure not to exceed the storage quota.  So delete the
oldest snapshots if you need to.
</ol></p>
  </td></tr></table>
  <br>

<a name="dist"></a>
  <table width=100% border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Releasing a Distribution</p>
      </td>
      <td align=right>
        <font size=-2>Peter Brett&nbsp;-&nbsp;15 Jan 2004</font>
      </td>
      <td width=1% align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width=100% cellspacing=10><tr><td>
<p>Before you'll be able to follow the process outlined below, you'll
need to read <a href="http://sourceforge.net/docman/display_doc.php?docid=6841&group_id=1">Introduction
to SSH on SourceForge.net</a>, and set up your system with PuTTY
accordingly.  I'm going to assume that you're running Windows. 
</p><p>In preparation for creating a distribution, you'll need to carry out a
couple of preliminary steps.
</p><p><ol><li>Download and install Nullsoft Scriptable Install System (NSIS)
2.0 beta 4 or higher from 
<a href="http://nsis.sourceforge.net">http://nsis.sourceforge.net</a>.
</li>
<li>Checkout the &nbsp;<tt>utils</tt>&nbsp; module from QuArK CVS on SourceForge.
This module contains the scripts and other files you'll need to be
able to create the distribution.</li>
<li>Make sure you have access permissions to work with the SourceForge
release system.</li>
</ol>
</p><p>So, once you've decided that you're ready to create a distribution,
here's what you do.
</p><p><ol>
<li>First, work out what the version number is for this distribution
(see <a href="src.distribution.html#policy">'QuArK Release Policy'</a>). You'll probably need to
discuss with other developers to decide what the state is going to be
and whether to increment the the minor version, but for the sake of
argument lets say the version number you come up with is '6.4.1beta3'.
</li>
<li>Most of creating a distribution is similar to creating a snapshot.
First, do steps 1 to 11 of <a href="src.distribution.html#snapshot">'Releasing a Snapshot'</a>, with
the difference that you name the files with the '6.4.1beta3' instead
of the date, so &nbsp;<tt>quark-win32-20070831</tt>&nbsp; becomes
&nbsp;<tt>quark-win32-6.4.1beta3</tt>&nbsp;.</li>
<li>Move your &nbsp;<tt>quark-win32-6.4.1beta3.zip</tt>&nbsp; to your shell server home
directory.
<div class="doccode"><pre>$ mv quark-win32-6.4.1beta3.zip ~/</pre></div></li>
<li>Upload the source and help distributions to the release system's
incoming directory.
<div class="doccode"><pre>$ ftp
ftp&gt; open upload.sourceforge.net
ftp&gt; binary
ftp&gt; put quark-src-6.4.1beta3.zip
ftp&gt; put quark-help-6.4.1beta3.zip
ftp&gt; put quark-win32-6.4.1beta3.zip
ftp&gt; quit</pre></div></li>
<li>Use PSFTP to download your &nbsp;<tt>quark-win32-6.4.1beta3.zip</tt>&nbsp; to your
own computer.
<div class="doccode"><pre>&gt; psftp shell.sourceforge.net
psftp&gt; get quark-win32-6.4.1beta3.zip
psftp&gt; quit</pre></div></li>
<li>Create a new directory somewhere on your system - let's say
&nbsp;<tt>C:\qrkinstall</tt>&nbsp; - and copy the files from your checkout of
&nbsp;<tt>utils/nsis-dist-tools</tt>&nbsp; to that directory.  You will need:
<ul>
<li>install_header.bmp</li>
<li>install_splash.bmp</li>
<li>license.rtf</li>
<li>QuArK.nsi</li>
</ul>
Use your favourite archiving program to extract the files from your
&nbsp;<tt>quark-win32-6.4.1beta3.zip</tt>&nbsp; to &nbsp;<tt>C:\qrkinstall\quark</tt>&nbsp;.
</li>
<li>Open &nbsp;<tt>QuArK.nsi</tt>&nbsp; and edit the &quot;QuArK Version&quot; section as
applicable.  In this case, you'd want it to look something like this:
<div class="doccode"><pre>!define QRK_MAJOR_VER 6.4
!define QRK_MINOR_VER 1
!define QRK_STATE &quot;beta&quot;
!define QRK_RELEASE 3
</pre></div>
Save and close.
</li>
<li>Right click on &nbsp;<tt>QuArK.nsi</tt>&nbsp; in Windows Explorer and select &quot;Compile
NSI (with bz2)&quot;.  Please use BZ2 compression, as it provides much better
compression ratios that ZIP (the default).</li>
<li>Upload the newly created &nbsp;<tt>quark-win32-6.4.1beta3.exe</tt>&nbsp; to the
incoming directory for the SourceForge release system.
<div class="doccode"><pre>&gt; ftp
ftp&gt; open upload.sourceforge.net
ftp&gt; binary
ftp&gt; put quark-win32-6.4.1beta3.exe
ftp&gt; quit</pre></div></li>
<li>All the distribution files (&nbsp;<tt>quark-src-6.4.1beta3.zip</tt>&nbsp;,
&nbsp;<tt>quark-help-6.4.1beta3</tt>&nbsp;, and &nbsp;<tt>quark-win32-6.4.1beta3</tt>&nbsp;)
are now ready for you to process them through the SourceForge release
system.  Don't forget that the release system upload directory is
flushed every 24 hours.</li>
</ol>
</p><p>Once you've finished doing the release, it would probably be a good
idea to update the main QuArK website and to post an announcement to the
quark and quark-news mailing lists, as well as adding links to the
snapshot webpage.
</p><p>TODO: Add instructions for actually using the SourceForge release system.</p>
  </td></tr></table>
  <br>

<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99% align=middle>
      <p class="sm">
        GNU General Public License by The QuArK (Quake Army Knife) Community - <a href="http://www.planetquake.com/quark">http://www.planetquake.com/quark</a>
      </p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.delphi.html">Prev</a></span>&nbsp;-&nbsp;<a href="#__top__">Top</a>&nbsp;-&nbsp;<span class="navenable"><a href="plans.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
</body>
</html>