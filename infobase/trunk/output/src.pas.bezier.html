
<html>
<head>
  <title>Bezier.pas</title>
  <meta name="Description" content="QuArK Information Database - Page: 4.6.3.&nbsp;Bezier.pas">
  <meta name="Keywords" content="QuArK InfoBase Quake Army Knife QRK QKM Python PY Map Editor Hexen Heretic Half-Life Sin Kingpin Soldier-of-Fortune Star-Trek-Voyager Elite-Force">
</head>

<link rel=stylesheet href="standard.css" type="text/css">

<body>
<a name="__top__"></a>
<table width=100% border=0 cellspacing=0>
  <tr>
    <td width=213>
      <a href="http://www.planetquake.com/quark"><img src="quarkicon.png" width=213 height=90 border=0 alt="Go to QuArK Web Site"></a>
    </td>
    <td width=70% align=center>
      <div class="topheadline">Bezier.pas</div>
      <div class="sm">Updated&nbsp;30 Oct 2000</div>
    </td>
    <td width=30% valign=bottom nowrap>
      Upper&nbsp;levels:<br>-&nbsp;<a href="index.html">QuArK&nbsp;Information&nbsp;Base</a><br>-&nbsp;<a href="src.html">4.&nbsp;The&nbsp;Source&nbsp;Code</a><br>-&nbsp;<a href="src.pas.html">4.6.&nbsp;File-by-file&nbsp;descriptions</a><br>
    </td>
  </tr>
</table>
<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99%>
      <p class="headline">&nbsp;4.6.3.&nbsp;Bezier.pas</p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.pas.qkobjects.html">Prev</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.pas.html">Up</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.pas.qkmap.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
<table border=0 width=100% cellspacing=10><tr><td><p>This file contains all the Delphi part of the code related to Quake 3's Quadratic Bezier patches.
</p>
</td></tr></table>
<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=100%>
      <p class="subheadline">&nbsp;Index</p>
    </td>
  </tr>
</table>
<ul class="index">
  <li>- <a href="#quadmath">What is the math behind Quadratic Bezier patches?</a>&nbsp;<span class="added">(30 Oct 2000)</span>
  <li>- <a href="#paste">The Bezier patch objects</a>&nbsp;<span class="added">(30 Oct 2000)</span>
</ul>
<br>


<a name="quadmath"></a>
  <table width=100% border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;What is the math behind Quadratic Bezier patches?</p>
      </td>
      <td align=right>
        <font size=-2>Armin Rigo&nbsp;-&nbsp;30 Oct 2000</font>
      </td>
      <td width=1% align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width=100% cellspacing=10><tr><td>
<p>These patches are defined with 9 (3x3) control points. Each control point
has 5 coordinates: x,y,z (in 3D space) and s,t (texture coordinates).
</p><p>In the map editor when you first insert a patch, its control points are
ordered like this in the xy (top-down) view:
</p><div class="doccode"><pre>
  6 7 8           c20 c21 c22
  3 4 5     or    c10 c11 c12
  0 1 2           c00 c01 c02
</pre></div>

<p>The patch is a parametric surface for two parameters u,v ranging between
0 and 1. Each for the 5 coordinates is computed using the formula described
below.
</p><p>A Quadratic Bezier Line is a curve defined by 3 control points and
parametrized by a single variable u ranging between 0 and 1. If the 3
control points are p0, p1, p2 then the curve is parametrized by:
</p><div class="doccode"><pre>
  f(u,p0,p1,p2)  =  p0 * (1-u)^2  +  p1 * 2u(1-u)  +  p2 * u^2
</pre></div>

<p>The Bezier surface is obtained by applying this formula for u and for v:
if cji (i=0,1,2; j=0,1,2) are the 9 control points then
</p><div class="doccode"><pre>
  g(u,v) = f(u, f(v,c00,c10,c20), f(v,c01,c11,c21), f(v,c02,c12,c22))
</pre></div>

<p>The formula can be seen as operating on each coordinate independently,
or on all 5 cordinates at the same time (with vector sum and multiply
in the real 5-dimensional vector space). In TBezier.BuildMeshCache
the computations are done on the first 3 coordinates only because the
texture coordinates are not cached.
</p><p>The &quot;speed vectors&quot; 'dg/du' and 'dg/dv' are vectors that attach to each
point (u,v) on the surface of the patch; they are the derivative of the
function g. They tell &quot;how fast&quot; the point on the patch moves when u and
v move. They are computed by extending as above the similar notion of
speed on the Bezier curves:
</p><div class="doccode"><pre>
  df/du (u,p0,p1,p2)  =  p0 * (-2)*(1-u)  +  p1 * (2-4u)  +  p2 * 2u
</pre></div>

<p>The vectors 'dg/du' and 'dg/dv' can also be used to compute (by cross
product) a vector orthogonal to the surface at a given point.
</p>
  </td></tr></table>
  <br>

<a name="paste"></a>
  <table width=100% border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;The Bezier patch objects</p>
      </td>
      <td align=right>
        <font size=-2>Armin Rigo&nbsp;-&nbsp;30 Oct 2000</font>
      </td>
      <td width=1% align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width=100% cellspacing=10><tr><td>
<p>Try copying the text below and pasting it into QuArK. It will
automatically be translated into an object -- in this case, a
test Bezier patch.
</p><div class="doccode"><pre>
QQRKSRC1
{
  test:b2 = {
    v = '0 0 0 0 0      64 0 0 64 0      128 0 0 128 0
         0 64 0 0 64    64 64 0 64 64    128 64 0 128 64
         0 128 0 0 128  64 128 0 64 128  128 128 0 128 128'
  }
}
</pre></div>

<p>The 'v' specific contains 5 values (x,y,z,s,t coordinates) for each
control point, that is, 45 values in total.
</p><p>This specific can be directly manipulated by Python code,
but it's generally simpler to read and write the Python attribute
&quot;cp&quot; (Control Points), which returns (resp. must be set to) a 3-tuple
of 3-tuples of vectors (note: QuArK now supports &quot;quilts&quot;, which mean
that the dimension of the &quot;cp&quot; rectangular matrix can actually be any
odd number.)
</p><p>Vectors have been enhanced in this version of QuArK to allow them to
hold all 5 coordinates of the control points. You create such a vector
by passing 5 arguments to the function &quot;quarkx.vect&quot;. The extra coordinates
can be readen through the vector's &quot;tex_s&quot; and &quot;tex_t&quot; attributes, as well
as through &quot;tex&quot; which directly returns a 2-tuple (tex_s, tex_t).
</p>
  </td></tr></table>
  <br>

<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99% align=middle>
      <p class="sm">
        GNU General Public License by The QuArK (Quake Army Knife) Community - <a href="http://www.planetquake.com/quark">http://www.planetquake.com/quark</a>
      </p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.pas.qkobjects.html">Prev</a></span>&nbsp;-&nbsp;<a href="#__top__">Top</a>&nbsp;-&nbsp;<span class="navenable"><a href="src.pas.qkmap.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
</body>
</html>