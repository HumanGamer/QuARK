
<html>
<head>
  <title>QkQ3A.pas</title>
  <meta name="Description" content="QuArK Information Database - Page: 4.6.5.&nbsp;QkQ3A.pas">
  <meta name="Keywords" content="QuArK InfoBase Quake Army Knife QRK QKM Python PY Map Editor Hexen Heretic Half-Life Sin Kingpin Soldier-of-Fortune Star-Trek-Voyager Elite-Force">
</head>

<link rel=stylesheet href="standard.css" type="text/css">

<body>
<a name="__top__"></a>
<table width=100% border=0 cellspacing=0>
  <tr>
    <td width=213>
      <a href="http://www.planetquake.com/quark"><img src="quarkicon.png" width=213 height=90 border=0 alt="Go to QuArK Web Site"></a>
    </td>
    <td width=70% align=center>
      <div class="topheadline">QkQ3A.pas</div>
      <div class="sm">Updated&nbsp;23 Feb 2001</div>
    </td>
    <td width=30% valign=bottom nowrap>
      Upper&nbsp;levels:<br>-&nbsp;<a href="index.html">QuArK&nbsp;Information&nbsp;Base</a><br>-&nbsp;<a href="src.html">4.&nbsp;The&nbsp;Source&nbsp;Code</a><br>-&nbsp;<a href="src.pas.html">4.6.&nbsp;File-by-file&nbsp;descriptions</a><br>
    </td>
  </tr>
</table>
<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99%>
      <p class="headline">&nbsp;4.6.5.&nbsp;QkQ3A.pas</p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.pas.qkmap.html">Prev</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.pas.html">Up</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.pas.3drender.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
<table border=0 width=100% cellspacing=10><tr><td><p>Code specific to Quake 3.</p>
</td></tr></table>
<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=100%>
      <p class="subheadline">&nbsp;Index</p>
    </td>
  </tr>
</table>
<ul class="index">
  <li>- <a href="#shaders">Shaders</a>&nbsp;<span class="added">(23 Feb 2001)</span>
</ul>
<br>


<a name="shaders"></a>
  <table width=100% border=0 cellspacing=0>
    <tr class="headline">
      <td>
        <p class="item">&nbsp;Shaders</p>
      </td>
      <td align=right>
        <font size=-2>Armin Rigo&nbsp;-&nbsp;23 Feb 2001</font>
      </td>
      <td width=1% align=right nowrap>
        &nbsp;&nbsp;[&nbsp;<a href="#__top__">Top</a>&nbsp;]&nbsp;
      </td>
    </tr>
  </table>
  <table border=0 width=100% cellspacing=10><tr><td>
<p>The Quake 3 shaders are stored in a set of &quot;.shader&quot; file. This file format
corresponds to the QShaderFile object class. Each .shader file can contain
several shaders, so when loaded from disk, the QShaderFile object loads each
shader in a subobject; this subobject itself is of class QShader.
</p><p>Here is an example of a shader in a .shader file:
</p><div class="doccode"><pre>
textures/base_button/shootme2
{
  qer_editorimage textures/base_button/shootme1.tga
  q3map_lightimage textures/base_button/shootme_glow.tga
  q3map_surfacelight 1000
  light 1
  {
    map $lightmap
    rgbGen identity
  }
  {
    map textures/base_support/metal3_3.tga
    blendFunc GL_DST_COLOR GL_ZERO
    rgbGen identity
  }
  {
    map textures/base_button/shootme_glow.tga
    rgbGen wave sin 0.5 1.0 0 ..3
    blendFunc GL_ONE GL_ONE
  }
}
</pre></div>

<p>A shader like this is loaded into a single QShader file with the first few
lines as specific/args, that is, 'qer_editorimage' with value
'textures/base_button/shootme1.tga', then 'q3map_lightimage' with value
'textures/base_button/shootme_glow.tga', followed by 'q3map_surfacelight' with
value '1000', and then 'light' with value '1'.
</p><p>The following brace-enclosed parts are stored in a subobject each. The name of
these subobjects is what 'map' specify (just like the name of the entities in a
map is what their 'classname' specify). The other specific/args are stored as
is in the subobject.
</p><p>This was the loading process; as always in QuArK it does little more than
mapping a file format into an organized hierarchy of objects with
specific/args. Actual interpretation of these specific/args is given by the
class of the objects : QShaderFile, which contain QShader objects, each of
which contain a list of objects of class QShaderItem. QShaderFile inherits from
QLvFileObject because it has no particular purpose other than being a list of
shaders.
</p><p>QShader is more subtle. It inherits from QPixelSet because a shader can be used
as a texture in the map editor. A QShader object must actually provide an image
by overriding the abstract &quot;Description&quot; method of QPixelSet; this is needed so
that the map editor knows the image it must display in places such as the 3D
viewers. But a shader generally involves several texture images, in Quake 3's
point of view. This means that the QShader object must build a &quot;best-possible&quot;
single image. The easiest way to do this is to use, say, the first specified
texture that is not a special one (&quot;map $lightmap&quot; is a special one). Be aware
however that this image is just a trick required by map editing; it does not
reflect the quantity of information that a whole shader actually contains.
That's why QShader inherits from QPixelSet directly and not from QTexture nor
QImage.
</p><p>The QShaderItem class, on the other hand, inherits from QTextureLnk because it
is really a kind of link to a texture. It differs from QTextureLnk in its
implementation of &quot;LoadPixelSet&quot; : a QShaderItem loads the texture based on the
object name (originally the 'map' entry in the .shader file). Special names
like $lightmap correspond to a default texture -- e.g. the $lightmap should be
matched to a special image object similar to the 'clip' textures of Quake 1&amp;2;
in this case it would be some black image with the text 'lightmap' on it.
</p><p>The object structure itself is enough to make the texture browser work
correctly with shaders : when viewed from inside a texture list, they display
their default best-possible image, but they can also be expanded in the tree
(as you would open a group) to reveal their QShaderItem sub-images.
</p><p>QShader itself overrides the function 'OpenWindow'
so that when one clicks on a shader in the texture browser it displays a list
of its QShaderItems. This is done by a form &quot;TFQShader&quot; overriding &quot;TQForm2&quot;,
similarly to &quot;TFQWad&quot;, which displays the list of textures inside a QWad
object.
</p><p>The last main issue about shaders is in an extension of
QTextureLnk.LoadPixelSet, which must look for a shader when instructed to do
so. In this case it loads the shader file using NeedBaseGameFile (just like a
Quake 1 texture needs to be loaded from .bsp file); then it looks for the good
QShader inside this QShaderFile object.
</p>
  </td></tr></table>
  <br>

<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99% align=middle>
      <p class="sm">
        GNU General Public License by The QuArK (Quake Army Knife) Community - <a href="http://www.planetquake.com/quark">http://www.planetquake.com/quark</a>
      </p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.pas.qkmap.html">Prev</a></span>&nbsp;-&nbsp;<a href="#__top__">Top</a>&nbsp;-&nbsp;<span class="navenable"><a href="src.pas.3drender.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
</body>
</html>