
<html>
<head>
  <title>Mouse in the Map View</title>
  <meta name="Description" content="QuArK Information Database - Page: 4.5.3.&nbsp;Mouse in the Map View">
  <meta name="Keywords" content="QuArK InfoBase Quake Army Knife QRK QKM Python PY Map Editor Hexen Heretic Half-Life Sin Kingpin Soldier-of-Fortune Star-Trek-Voyager Elite-Force">
</head>

<link rel=stylesheet href="standard.css" type="text/css">

<body>
<a name="__top__"></a>
<table width=100% border=0 cellspacing=0>
  <tr>
    <td width=213>
      <a href="http://www.planetquake.com/quark"><img src="quarkicon.png" width=213 height=90 border=0 alt="Go to QuArK Web Site"></a>
    </td>
    <td width=70% align=center>
      <div class="topheadline">Mouse in the Map View</div>
      <div class="sm">Updated&nbsp;26 Aug 2005</div>
    </td>
    <td width=30% valign=bottom nowrap>
      Upper&nbsp;levels:<br>-&nbsp;<a href="index.html">QuArK&nbsp;Information&nbsp;Base</a><br>-&nbsp;<a href="src.html">4.&nbsp;The&nbsp;Source&nbsp;Code</a><br>-&nbsp;<a href="src.topics.html">4.5.&nbsp;Specific&nbsp;Topics</a><br>
    </td>
  </tr>
</table>
<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99%>
      <p class="headline">&nbsp;4.5.3.&nbsp;Mouse in the Map View</p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.topics.beziers.html">Prev</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.topics.html">Up</a></span>&nbsp;-&nbsp;<span class="navenable"><a href="src.topics.mapsave.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
<table border=0 width=100% cellspacing=10><tr><td><p>Processing mouse events (moves, drags and clicks) is distributed between
the Python and Delphi components of QuArK.  The mapview control
(see <a href="src.quarkx.html#mapviewmethods">'Methods of Map View controls'</a>) is basically in charge of it
all.  When a map or model editor is launched, mapview controls get associated
with certain areas of the screen.  These have an <strong>onmouse</strong>
callback function, which is assigned to a Python-defined function by a
line like this (from quarkpy.qbaseeditor):
<div class="doccode"><pre>
        v.onmouse = self.mousemap
</pre></div>
Every time the mouse is moved, the mousemap function of 'self' (an editor)
is called.  For editors as defined in qbaseeditor, the mousemap function
starts out like this:
<div class="doccode"><pre>
    def mousemap(self, view, x, y, flags, handle):
</pre></div>
where 'flags' is a string containing information about what buttons were
depressed, and handle is any handle that the mouse is over.  The flags
string doesn't indicate directly what key was pressed, but rather codes
functions, mediated by the Map|Mouse setup options.
</p><p>For clicks, the real processing is done by the MouseClicked function,
which is defined by the editor's HandlesModule (maphandles for the
map editor), which itself calls the mapview method Clicktarget.  This latter
is defined in Delphi, and calls the AnalyseClic methods of the various
kinds of map objects to find out if the click was 'over' each object in
the map.  These methods take as parameter a List, to which they add
the click-ed on stuff they find.
</p><p>A bit oddly, the map editor's MouseClicked method calls on the qhandle
MouseClicked method for some processing, I'm not sure why it's set up
this way, but anyway Python is responsible for the 'drill thru' selection
model whereby the top thing is selected first, then the one under that,
etc, and quite a lot of selection behavior can be manipulated in Python.
</p>
</td></tr></table>
<br>

<table width=100% border=0 cellspacing=0>
  <tr class="headline">
    <td width=99% align=middle>
      <p class="sm">
        GNU General Public License by The QuArK (Quake Army Knife) Community - <a href="http://www.planetquake.com/quark">http://www.planetquake.com/quark</a>
      </p>
    </td>
    <td width=1% align=right nowrap>
      &nbsp;[&nbsp;<span class="navenable"><a href="src.topics.beziers.html">Prev</a></span>&nbsp;-&nbsp;<a href="#__top__">Top</a>&nbsp;-&nbsp;<span class="navenable"><a href="src.topics.mapsave.html">Next</a></span>&nbsp;]&nbsp;
    </td>
  </tr>
</table>
</body>
</html>